#include "dn_rendering.h"
#include "dn_simple_drawing.h"
#include "dn_events.h"
#include "dn_io.h"
#include "dn.h"

<<<<<<< HEAD
static void vsync(void)
=======
static inline void vsync(t_game_state *game_state)
>>>>>>> a3470ec656a2814f7be1e942ed4493c7f0f008e7
{
	const unsigned	current_ticks = SDL_GetTicks();
	unsigned		frame_time;
	t_game_state	*game_state;

	game_state = get_game_state();
	frame_time = current_ticks - game_state->last_time;
	if (frame_time < 16)
		WAIT(16 - frame_time);
	game_state->last_time = current_ticks;
	game_state->frame_time = frame_time;
}

void init_render_state(void)
{
	t_render_state *render_state;

	render_state = get_render_state();
	render_state->renderer =
		SDL_CreateRenderer(render_state->window, -1, SDL_RENDERER_ACCELERATED);
	//SDL_RenderSetLogicalSize(render_state->renderer, render_state->w, render_state->h);
	render_state->pixels = ft_memalloc(sizeof(int) * (render_state->w * render_state->h));
	render_state->back_buffer = SDL_CreateTexture(render_state->renderer,
<<<<<<< HEAD
	SDL_PIXELFORMAT_RGB888, SDL_TEXTUREACCESS_STREAMING, render_state->w, render_state->h);
=======
	SDL_PIXELFORMAT_ARGB8888, SDL_TEXTUREACCESS_STREAMING, render_state->w, render_state->h);
>>>>>>> a3470ec656a2814f7be1e942ed4493c7f0f008e7
}

void	draw_loop()
{
<<<<<<< HEAD
	static int i = 10;
	t_render_state *render_state = get_render_state();

	init_render_state();
	while (true)
	{
		t_simple_vline line = { i, 100, 200, 0xFFFF};
		draw_vline((RENDERABLE)render_state, line);
		i++;

		SDL_UpdateTexture(render_state->back_buffer, NULL, render_state->pixels, render_state->w << 2);
		SDL_RenderCopy(render_state->renderer, render_state->back_buffer, NULL, NULL);
		SDL_RenderPresent(render_state->renderer);
		vsync();
=======
	init_renderer(&game_state->render_state);
	while (true)
	{
		

		SDL_UpdateTexture(game_state->render_state.back_buffer, NULL, game_state->render_state.pixels, game_state->render_state.w * 4);
		SDL_RenderCopy(game_state->render_state.renderer, game_state->render_state.back_buffer, NULL, NULL);
		SDL_RenderPresent(game_state->render_state.renderer);
		vsync(game_state);
>>>>>>> a3470ec656a2814f7be1e942ed4493c7f0f008e7
	}
}

t_render_state * get_render_state(void)
{
	static t_render_state render_state;
	return &render_state;
}
